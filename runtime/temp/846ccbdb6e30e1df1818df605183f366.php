<?php /*a:3:{s:62:"F:\project\shop\ThinkAdmin\app\data\view\user\admin\index.html";i:1648774486;s:67:"F:\project\shop\ThinkAdmin\app\data\view\..\..\admin\view\main.html";i:1648774486;s:69:"F:\project\shop\ThinkAdmin\app\data\view\user\admin\index_search.html";i:1648774486;}*/ ?>
<div class="layui-card"><?php if(!(empty($title) || (($title instanceof \think\Collection || $title instanceof \think\Paginator ) && $title->isEmpty()))): ?><div class="layui-card-header"><span class="layui-icon font-s10 color-desc margin-right-5">&#xe65b;</span><?php echo htmlentities((isset($title) && ($title !== '')?$title:''),ENT_QUOTES); ?><div class="pull-right"><!--<?php if(auth("sync")): ?>--><button class='layui-btn layui-btn-sm layui-btn-primary' data-queue="<?php echo url('sync'); ?>">刷新用户金额</button><!--<?php endif; ?>--><!--<?php if(auth("base.upgrade/sync")): ?>--><button class='layui-btn layui-btn-sm layui-btn-primary' data-queue="<?php echo url('base.upgrade/sync'); ?>">刷新用户等级</button><!--<?php endif; ?>--></div></div><?php endif; ?><div class="layui-card-line"></div><div class="layui-card-body"><div class="layui-card-html"><div class="layui-tab layui-tab-card"><ul class="layui-tab-title notselect"><?php foreach($total as $k=>$v): if(isset($type) and 't'.$type == $k): ?><li class="layui-this" data-open="<?php echo url('index'); ?>?type=<?php echo htmlentities($k,ENT_QUOTES); ?>"><?php if(is_numeric($v['vip'])): ?><span class="color-red margin-right-5">[<b class="margin-col-5 font-s12">VIP<?php echo htmlentities($v['vip'],ENT_QUOTES); ?></b>]</span><?php endif; ?><span><?php echo htmlentities($v['name'],ENT_QUOTES); ?></span><sup class="layui-badge border-radius"><?php echo htmlentities((isset($v['count']) && ($v['count'] !== '')?$v['count']:0),ENT_QUOTES); ?></sup></li><?php else: ?><li data-open="<?php echo url('index'); ?>?type=<?php echo htmlentities($k,ENT_QUOTES); ?>"><?php if(is_numeric($v['vip'])): ?><span class="color-desc margin-right-5">[<b class="margin-col-5 font-s12">VIP<?php echo htmlentities($v['vip'],ENT_QUOTES); ?></b>]</span><?php endif; ?><span><?php echo htmlentities($v['name'],ENT_QUOTES); ?></span><sup class="layui-badge border-radius"><?php echo htmlentities((isset($v['count']) && ($v['count'] !== '')?$v['count']:0),ENT_QUOTES); ?></sup></li><?php endif; ?><?php endforeach; ?></ul><div class="layui-tab-content"><fieldset><legend>条件搜索</legend><form action="<?php echo sysuri(); ?>" autocomplete="off" class="layui-form layui-form-pane form-search" method="get" onsubmit="return false"><div class="layui-form-item layui-inline"><label class="layui-form-label">用户手机</label><label class="layui-input-inline"><input class="layui-input" name="phone" placeholder="请输入用户手机" value="<?php echo htmlentities((isset($get['phone']) && ($get['phone'] !== '')?$get['phone']:''),ENT_QUOTES); ?>"></label></div><div class="layui-form-item layui-inline"><label class="layui-form-label">用户昵称</label><label class="layui-input-inline"><input class="layui-input" name="username" placeholder="请输入用户昵称" value="<?php echo htmlentities((isset($get['username']) && ($get['username'] !== '')?$get['username']:''),ENT_QUOTES); ?>"></label></div><!--<?php if(!(empty($upgrades) || (($upgrades instanceof \think\Collection || $upgrades instanceof \think\Paginator ) && $upgrades->isEmpty()))): ?>--><div class="layui-form-item layui-inline"><label class="layui-form-label">用户等级</label><div class="layui-input-inline"><select class="layui-select" name="vip_code"><option value="">-- 全部 --</option><?php foreach($upgrades as $upgrade): if(input('vip_code') == $upgrade['number'].''): ?><option selected value="<?php echo htmlentities((isset($upgrade['number']) && ($upgrade['number'] !== '')?$upgrade['number']:0),ENT_QUOTES); ?>">[ VIP<?php echo htmlentities((isset($upgrade['number']) && ($upgrade['number'] !== '')?$upgrade['number']:'0'),ENT_QUOTES); ?> ] <?php echo htmlentities((isset($upgrade['name']) && ($upgrade['name'] !== '')?$upgrade['name']:''),ENT_QUOTES); ?></option><?php else: ?><option value="<?php echo htmlentities((isset($upgrade['number']) && ($upgrade['number'] !== '')?$upgrade['number']:0),ENT_QUOTES); ?>">[ VIP<?php echo htmlentities((isset($upgrade['number']) && ($upgrade['number'] !== '')?$upgrade['number']:'0'),ENT_QUOTES); ?> ] <?php echo htmlentities((isset($upgrade['name']) && ($upgrade['name'] !== '')?$upgrade['name']:''),ENT_QUOTES); ?></option><?php endif; ?><?php endforeach; ?></select></div></div><!--<?php endif; ?>--><div class="layui-form-item layui-inline"><label class="layui-form-label">代理手机</label><label class="layui-input-inline"><input class="layui-input" name="from_phone" placeholder="请输入代理手机" value="<?php echo htmlentities((isset($get['from_phone']) && ($get['from_phone'] !== '')?$get['from_phone']:''),ENT_QUOTES); ?>"></label></div><div class="layui-form-item layui-inline"><label class="layui-form-label">代理昵称</label><label class="layui-input-inline"><input class="layui-input" name="from_username" placeholder="请输入代理昵称" value="<?php echo htmlentities((isset($get['from_username']) && ($get['from_username'] !== '')?$get['from_username']:''),ENT_QUOTES); ?>"></label></div><!--<?php if(!(empty($upgrades) || (($upgrades instanceof \think\Collection || $upgrades instanceof \think\Paginator ) && $upgrades->isEmpty()))): ?>--><div class="layui-form-item layui-inline"><label class="layui-form-label">代理等级</label><div class="layui-input-inline"><select class="layui-select" name="from_vipcode"><option value="">-- 全部 --</option><?php foreach($upgrades as $upgrade): if(input('from_vipcode') == $upgrade['number'].''): ?><option selected value="<?php echo htmlentities((isset($upgrade['number']) && ($upgrade['number'] !== '')?$upgrade['number']:0),ENT_QUOTES); ?>">[ VIP<?php echo htmlentities((isset($upgrade['number']) && ($upgrade['number'] !== '')?$upgrade['number']:'0'),ENT_QUOTES); ?> ] <?php echo htmlentities((isset($upgrade['name']) && ($upgrade['name'] !== '')?$upgrade['name']:''),ENT_QUOTES); ?></option><?php else: ?><option value="<?php echo htmlentities((isset($upgrade['number']) && ($upgrade['number'] !== '')?$upgrade['number']:0),ENT_QUOTES); ?>">[ VIP<?php echo htmlentities((isset($upgrade['number']) && ($upgrade['number'] !== '')?$upgrade['number']:'0'),ENT_QUOTES); ?> ] <?php echo htmlentities((isset($upgrade['name']) && ($upgrade['name'] !== '')?$upgrade['name']:''),ENT_QUOTES); ?></option><?php endif; ?><?php endforeach; ?></select></div></div><!--<?php endif; ?>--><div class="layui-form-item layui-inline"><label class="layui-form-label">使用状态</label><div class="layui-input-inline"><select class="layui-select" name="status"><option value="">-- 全部 --</option><?php foreach(['已冻结的用户', '已激活的用户'] as $k=>$v): if($k.'' == input('status')): ?><option selected value="<?php echo htmlentities($k,ENT_QUOTES); ?>"><?php echo htmlentities($v,ENT_QUOTES); ?></option><?php else: ?><option value="<?php echo htmlentities($k,ENT_QUOTES); ?>"><?php echo htmlentities($v,ENT_QUOTES); ?></option><?php endif; ?><?php endforeach; ?></select></div></div><div class="layui-form-item layui-inline"><label class="layui-form-label">注册时间</label><div class="layui-input-inline"><input class="layui-input" data-date-range name="create_at" placeholder="请选择注册时间" value="<?php echo htmlentities((isset($get['create_at']) && ($get['create_at'] !== '')?$get['create_at']:''),ENT_QUOTES); ?>"></div></div><div class="layui-form-item layui-inline"><button class="layui-btn layui-btn-primary"><i class="layui-icon">&#xe615;</i> 搜 索</button><button class="layui-btn layui-btn-primary" data-form-export="<?php echo url('index'); ?>?type=<?php echo htmlentities($type,ENT_QUOTES); ?>" type="button"><i class="layui-icon layui-icon-export"></i> 导 出
            </button></div></form></fieldset><script>    require(['excel'], function (excel) {
        excel.bind(function (data) {
            var items = [];
            items.push(['用户编号', '小程序OPENID', '公众号OPNID', '用户姓名', '用户等级', '累计充值余额', '已使用余额', '累计返利金额', '锁定返利金额', '已提现金额', '注册时间']);
            data.forEach(function (item) {
                items.push([
                    {v: item.id, t: 'n'},
                    item.openid1,
                    item.openid2,
                    item.username || item.nickname || '',
                    item.vip_name,
                    {v: item.balance_total, t: 'n'},
                    {v: item.balance_used, t: 'n'},
                    {v: item.rebate_total, t: 'n'},
                    {v: item.rebate_lock, t: 'n'},
                    {v: item.rebate_used, t: 'n'},
                    item.create_at || '',
                ]);
            });
            return items;
        }, '会员用户数据');
    });
</script><table class="layui-table margin-top-10" lay-skin="line"><?php if(!(empty($list) || (($list instanceof \think\Collection || $list instanceof \think\Paginator ) && $list->isEmpty()))): ?><thead><tr><th class='list-table-check-td think-checkbox'><label><input data-auto-none data-check-target='.list-check-box' type='checkbox'></label></th><th class='nowrap'>用户信息</th><th class='nowrap'>代理信息</th><th class='nowrap'>余额统计</th><th class='nowrap'>返利统计</th><th class='nowrap'>团队统计</th><th class='nowrap'>用户状态</th><th class='nowrap'></th></tr></thead><?php endif; ?><tbody><?php foreach($list as $key=>$vo): ?><tr><td class='list-table-check-td think-checkbox'><label><input class="list-check-box" type='checkbox' value='<?php echo htmlentities($vo['id'],ENT_QUOTES); ?>'></label></td><td class="nowrap"><div class="headimg headimg-md" data-tips-hover data-tips-image data-lazy-src="<?php echo htmlentities((isset($vo['headimg']) && ($vo['headimg'] !== '')?$vo['headimg']:'/static/theme/img/headimg.png'),ENT_QUOTES); ?>"></div><div class="inline-block"><div><?php if(!(empty($vo['username']) || (($vo['username'] instanceof \think\Collection || $vo['username'] instanceof \think\Paginator ) && $vo['username']->isEmpty()))): ?>                            用户姓名：<span class="color-text"><?php echo htmlentities((isset($vo['username']) && ($vo['username'] !== '')?$vo['username']:'-'),ENT_QUOTES); ?></span><?php else: ?>                            用户昵称：<span class="color-text"><?php echo htmlentities((isset($vo['nickname']) && ($vo['nickname'] !== '')?$vo['nickname']:'-'),ENT_QUOTES); ?></span><?php endif; ?></div><div>用户手机：<span class="color-text"><?php echo htmlentities((isset($vo['phone']) && ($vo['phone'] !== '')?$vo['phone']:'-'),ENT_QUOTES); ?></span></div><div>用户等级：[ <b class="color-red">VIP<?php echo htmlentities($vo['vip_code'],ENT_QUOTES); ?></b> ] <b class="color-red"><?php echo htmlentities($vo['vip_name'],ENT_QUOTES); ?></b></div></div></td><td class="nowrap"><?php if(!(empty($vo['from']) || (($vo['from'] instanceof \think\Collection || $vo['from'] instanceof \think\Paginator ) && $vo['from']->isEmpty()))): ?><div class="headimg headimg-md" data-tips-hover data-tips-image data-lazy-src="<?php echo htmlentities((isset($vo['from']['headimg']) && ($vo['from']['headimg'] !== '')?$vo['from']['headimg']:'/static/theme/img/headimg.png'),ENT_QUOTES); ?>"></div><div class="inline-block"><div><?php if(!(empty($vo['from']['username']) || (($vo['from']['username'] instanceof \think\Collection || $vo['from']['username'] instanceof \think\Paginator ) && $vo['from']['username']->isEmpty()))): ?>                            用户姓名：<span class="color-text"><?php echo htmlentities((isset($vo['from']['username']) && ($vo['from']['username'] !== '')?$vo['from']['username']:'-'),ENT_QUOTES); ?></span><?php else: ?>                            用户昵称：<span class="color-text"><?php echo htmlentities((isset($vo['from']['nickname']) && ($vo['from']['nickname'] !== '')?$vo['from']['nickname']:'-'),ENT_QUOTES); ?></span><?php endif; ?></div><div>用户手机：<span class="color-text"><?php echo htmlentities((isset($vo['from']['phone']) && ($vo['from']['phone'] !== '')?$vo['from']['phone']:'-'),ENT_QUOTES); ?></span></div><div>用户等级：[ <b class="color-red">VIP<?php echo htmlentities($vo['from']['vip_code'],ENT_QUOTES); ?></b> ] <b class="color-red"><?php echo htmlentities($vo['from']['vip_name'],ENT_QUOTES); ?></b></div></div><?php else: ?><div class="color-desc">没有代理</div><?php endif; ?></td><td class="nowrap sub-strong-blue sub-strong-s14"><div>累计充值 <b><?php echo htmlentities($vo['balance_total']+0,ENT_QUOTES); ?></b> 元</div><div>已经交易 <b><?php echo htmlentities($vo['balance_used']+0,ENT_QUOTES); ?></b> 元</div><div>可用余额 <b><?php echo round($vo['balance_total']-$vo['balance_used'],2)+0; ?></b> 元</div></td><td class="nowrap sub-strong-blue sub-strong-s14"><div>累计返利 <b><?php echo htmlentities($vo['rebate_total']+0,ENT_QUOTES); ?></b><span class="color-red font-w7" data-tips-text="未到账">+<?php echo htmlentities($vo['rebate_lock']+0,ENT_QUOTES); ?></span> 元</div><div>已经提现 <b><?php echo htmlentities($vo['rebate_used']+0,ENT_QUOTES); ?></b> 元</div><div>剩余提现 <b><?php echo round($vo['rebate_total']-$vo['rebate_used'],2)+0; ?></b> 元</div></td><td class="nowrap sub-strong-blue sub-strong-s14"><div>全部团队 <b><?php echo htmlentities($vo['teams_users_total'],ENT_QUOTES); ?></b> 人 ( 业绩 <b><?php echo htmlentities($vo['teams_amount_total']+0,ENT_QUOTES); ?></b> 元 )</div><div>直属团队 <b><?php echo htmlentities($vo['teams_users_direct'],ENT_QUOTES); ?></b> 人 ( 业绩 <b><?php echo htmlentities($vo['teams_amount_direct']+0,ENT_QUOTES); ?></b> 元 )</div><div>间接团队 <b><?php echo htmlentities($vo['teams_users_indirect'],ENT_QUOTES); ?></b> 人 ( 业绩 <b><?php echo htmlentities($vo['teams_amount_indirect']+0,ENT_QUOTES); ?></b> 元 )</div></td><td class="nowrap"><div>注册时间：<?php echo htmlentities(format_datetime($vo['create_at']),ENT_QUOTES); ?></div><div>                        代理关联：<!--<?php if(!(empty($vo['pids']) || (($vo['pids'] instanceof \think\Collection || $vo['pids'] instanceof \think\Paginator ) && $vo['pids']->isEmpty()))): ?>--><b class="color-green">永久绑定</b><!--<?php if(auth('parent')): ?>--><a data-width="1080px" data-height="700px" data-iframe="<?php echo url('parent'); ?>?uuid=<?php echo htmlentities($vo['id'],ENT_QUOTES); ?>" class="margin-left-5 notselect">更改绑定</a><!--<?php endif; ?>--><!--<?php else: ?>--><?php if(!(empty($vo['pid0']) || (($vo['pid0'] instanceof \think\Collection || $vo['pid0'] instanceof \think\Paginator ) && $vo['pid0']->isEmpty()))): ?><b class="color-red">临时绑定</b><!--<?php if(auth('forever')): ?>--><a data-confirm="改为永久绑定其代理后不能撤回，确认修改吗？" data-load="<?php echo url('forever'); ?>?id=<?php echo htmlentities($vo['id'],ENT_QUOTES); ?>" class="margin-left-5 notselect">改为永久</a><!--<?php endif; ?>--><?php else: ?><b class="color-desc">没有绑定</b><!--<?php if(auth('parent')): ?>--><a data-width="1080px" data-height="700px" data-iframe="<?php echo url('parent'); ?>?uuid=<?php echo htmlentities($vo['id'],ENT_QUOTES); ?>" class="margin-left-5 notselect">设置绑定</a><!--<?php endif; ?>--><?php endif; ?><!--<?php endif; ?>--><!--<?php if(auth('unbind')): ?>--><a data-confirm="设为总部用户后只能在后台设置其代理，确认设置吗？" data-load="<?php echo url('unbind'); ?>?id=<?php echo htmlentities($vo['id'],ENT_QUOTES); ?>" class="margin-left-5 notselect">设为总部</a><!--<?php endif; ?>--></div><div><span>用户状态：</span><span><?php if($vo['status'] == 0): ?><b class="color-red">已冻结</b><?php elseif($vo['status'] == 1): ?><b class="color-green">已激活</b><?php endif; ?></span><span class="margin-left-5"><?php if($vo['buy_vip_entry']): ?><b class="color-green">已入会</b><?php else: ?><b class="color-desc">未入会</b><?php endif; ?></span><span class="margin-left-5">累计交易 <b class="color-blue font-s14"><?php echo htmlentities($vo['order_amount_total']+0,ENT_QUOTES); ?></b> 元</span></div></td><td class="nowrap"><!--<?php if(auth("parent") and false): ?>--><a class="layui-btn layui-btn-sm layui-btn-primary" data-iframe="<?php echo url('parent'); ?>?uuid=<?php echo htmlentities($vo['id'],ENT_QUOTES); ?>" data-width="900px">修改上级</a><!--<?php endif; ?>--><!--<?php if(auth("user.balance/add")): ?>--><a class="layui-btn layui-btn-sm layui-btn-primary" data-modal="<?php echo url('user.balance/add'); ?>?uuid=<?php echo htmlentities($vo['id'],ENT_QUOTES); ?>" data-title="充值账户余额">充 值</a><!--<?php endif; ?>--><!--<?php if(auth("state") and $vo['status'] == 1): ?>--><a class="layui-btn layui-btn-sm layui-btn-danger" data-action="<?php echo url('state'); ?>" data-confirm="账号冻结后不能下单和提现，确定要冻结吗？" data-value="id#<?php echo htmlentities($vo['id'],ENT_QUOTES); ?>;status#0">冻 结</a><!--<?php endif; ?>--><!--<?php if(auth("state") and $vo['status'] == 0): ?>--><a class="layui-btn layui-btn-sm layui-btn-normal" data-action="<?php echo url('state'); ?>" data-value="id#<?php echo htmlentities($vo['id'],ENT_QUOTES); ?>;status#1">解 冻</a><!--<?php endif; ?>--></td></tr><?php endforeach; ?></tbody></table><?php if(empty($list) || (($list instanceof \think\Collection || $list instanceof \think\Paginator ) && $list->isEmpty())): ?><span class="notdata">没有记录哦</span><?php else: ?><?php echo (isset($pagehtml) && ($pagehtml !== '')?$pagehtml:''); ?><?php endif; ?></div></div></div></div></div>